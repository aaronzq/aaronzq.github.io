<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TransportVehicle  &middot; Aaron&#39;s Blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="A tiny robot car undertaking simple transportation mission. Based on the maze solver micromouse design." />

<meta name="keywords" content="TivaC, C/C&#43;&#43;, RTOS, Micromouse, ">


<meta property="og:title" content="TransportVehicle  &middot; Aaron&#39;s Blog ">
<meta property="og:site_name" content="Aaron&#39;s Blog"/>
<meta property="og:url" content="https://aaronzq.github.io/2017/11/07/transportvehicle/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content="A tiny robot car undertaking simple transportation mission. Based on the maze solver micromouse design."/>
<meta property="og:article:published_time" content="2017-11-07T14:15:29&#43;08:00" />
<meta property="og:article:modified_time" content="2017-11-07T14:15:29&#43;08:00" />

  
    
<meta property="og:article:tag" content="TivaC">
    
<meta property="og:article:tag" content="C/C&#43;&#43;">
    
<meta property="og:article:tag" content="RTOS">
    
<meta property="og:article:tag" content="Micromouse">
    
  

  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "TransportVehicle",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2017-11-07",
    "description": "A tiny robot car undertaking simple transportation mission. Based on the maze solver micromouse design.",
    "wordCount": 668
  }
</script>



<link rel="canonical" href="https://aaronzq.github.io/2017/11/07/transportvehicle/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://aaronzq.github.io/touch-icon-144-precomposed.png">
<link href="https://aaronzq.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.30.2" />

  
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://aaronzq.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://aaronzq.github.io/css/style.css">
<link rel="stylesheet" href="https://aaronzq.github.io/css/highlight/monokai_sublime.css">

  
  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://aaronzq.github.io/">
  aaronwang

</a>

</div>

  
<div class="container topline">
  
  Into T Space


</div>


</div>

  <nav class="container nav primary no-print">
  


  
<a href="https://aaronzq.github.io/about">about me</a>

<a href="https://aaronzq.github.io/categories" title="Show list of categories">categories</a>

<a href="https://aaronzq.github.io/post" title="Show list of posts">posts</a>

<a href="https://aaronzq.github.io/tags" title="Show list of tags">tags</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:aaron-zzz@outlook.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/aaronzq">
  <span class="fa fa-github-square"></span><span>github</span></a>























</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>TransportVehicle
</h1>

  <div class="metas">
<time datetime="2017-11-07">7 Nov, 2017</time>


  
  &middot; Read in about 4 min
  &middot; (668 Words)
  <br>
  
<a class="label" href="https://aaronzq.github.io/tags/tivac">TivaC</a>

<a class="label" href="https://aaronzq.github.io/tags/c/c&#43;&#43;">C/C&#43;&#43;</a>

<a class="label" href="https://aaronzq.github.io/tags/rtos">RTOS</a>

<a class="label" href="https://aaronzq.github.io/tags/micromouse">Micromouse</a>



</div>

</header>

  <div class="container content">
  

<h2 id="outline">Outline</h2>

<h4 id="our-robotcar">Our robotcar</h4>

<p>First we can take a look at what we have made below out of the material around us. The main compents have been marked out as red text, they can be easily bought via internet and assembled by your home tool box. So finally we get this lovely cute robot car. Everything we design for it is included in my <a href="https://github.com/aaronzq/Transport_microbot">github</a>.</p>

<p><img src="https://raw.githubusercontent.com/aaronzq/Transport_microbot/master/Pics/IMG_4045.JPG" width="640px" height="480px" /></p>

<p><img src="https://raw.githubusercontent.com/aaronzq/Transport_microbot/master/Pics/IMG_4044.JPG" width="640px" height="480px" /></p>

<p>There&rsquo;s something I need to point out if someone thoroughly followed our PCB design.   The motor driver DRV8848 we use here has one thing we omit while designing circuits. We have to use the blue wire(in the second pic) to touch the ground(voltage ground) to make the driver work in independent two channels everytime it&rsquo;s power on.</p>

<h4 id="program-flow">Program flow</h4>

<p>Power on. The two RGB leds will lit up. Red, Green, Blue, and the left went black and the right went red. You&rsquo;are now in &lsquo;mode choosing&rsquo;. Turn the left wheel and the color of the left led will change, different colors represents different mode like pwm test mode, IR monitor mode, run mode, these modes&rsquo; name were printed through bluetooth to your computer(if your computer was connected to a bluetooth pair, of course). Then turn the right wheel to launch the car. Red means the car is waiting for your choice and green means the mode is decided.</p>

<p>And if you chose the run mode, the car, according to our program, will follow the map border heading for the destination. And at the destination it will wait for the cargo(ping pong ball here) with led at red. As long as you put the cargo in the cavity then the led will turn green(successful detect) and the car will go all the way back and automatically unload the cargo by the blocking stick rotating down. Then it starts the next round. The video here. <em>todo</em><br />
Easy right?</p>

<h2 id="pid-tuning">PID tuning</h2>

<p>Here I didn&rsquo;t use the Matlab PID tuning tool, but if we can measure the system parameter precisely and model the system in Simulink, this tool is highly recommended.</p>

<p>So I just give it a desired velocity pair(linear velocity and angular velocity), and return the actual velocity (in 1000ms) measured by encoders to see how this close PID loop reacts to this traget value. Then I adjust the parameters basicly according to experience.</p>

<p>Empirically, the linear velocity loop and angular velocity loop can be tuned separately and independently. So we can , for example, test a pair (0.3m/s, 0rad/s) first and keep optimizing the LV loop paras to make the response faster and more stable and then the second pair (0m/s, 2rad/s) for AV loop.</p>

<p>It&rsquo;s important to know that when the vehicle make turns with a certain LV, the smaller the turning radius is, the more it requires for a better PID loop. So we have to consider how fast the response we need in real application. For example, at first I wanna the car to be able to turn at radius as small as 0.0175m and after I tuned the loop with (0m/s, 2rad/s) unit pulse well. It&rsquo;s actually far below the demand and went directly dead as long as it began to turn. So I finally loose the requirement on radius to 0.06m for I consider the loop response cannot be better.</p>

<h2 id="two-wheels-with-different-radius">Two wheels with different radius</h2>

<p>Use separate radius to calculate the speed from the encoders&rsquo; return value.</p>

<h2 id="keep-rotating-after-turning-back">Keep rotating after turning back</h2>

<p>When the car stops and turn back, I found it keep turning at a low angular velocity even if I have force the desire velocity pair to be (0m/s,0rad/s). It is because of the affect from the direction correction at the end of the last motion which left a extra crement at AV loop. So I mannuly set the direction error to be zero when it turns back.</p>

<h2 id="motion-parameters">Motion parameters</h2>

<p>The entire move is constituted by the combination of a series of basic motions. And there are so many parameters to tune to improve the perfermance of the robotcar.</p>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="https://aaronzq.github.io/2017/10/24/labnote/" title="Labnote">
      Previous
    </a>
    

    
    <a class="next" href="https://aaronzq.github.io/2017/12/17/widefieldnspim/" title="WidefieldnSPIM">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  

</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  
  Mark the Life


</div>


  
<div class="container copyright">
  
  &copy; 2017 Aaron


</div>


</div>

</footer>

    </main>
    


<script src="https://aaronzq.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


    
  </body>
</html>

